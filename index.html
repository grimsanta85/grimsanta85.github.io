<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/papaparse@5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.1.0/chroma.min.js"></script>
</head>
<style>
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
    }

    #map {
        width: 100%;
        height: 100%;
    }

    .legend {
        background-color: white;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
    }

    .legend-color {
        width: 20px;
        height: 20px;
        margin-right: 5px;
    }
    
    .info-container {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 10px;
        background-color: white;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        font-family: Arial, sans-serif;
        display: none;
    }

    .info-label {
        color: blue;
        font-weight: bold;
    }

    .info-value {
        color: red;
    }
</style>
<body>
    <div id="map"></div>
    <script>
        // Create a Leaflet map
        var map = L.map('map').setView([37.8, -96], 4);

        // Add a tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
            maxZoom: 18,
        }).addTo(map);

        // Load the CSV file using fetch API
        fetch('data.csv', { mode: 'same-origin' })
            .then(response => response.text())
            .then(csv => {
                var results = Papa.parse(csv, { header: true });
                // Load the GeoJSON file
                fetch('https://gist.githubusercontent.com/sdwfrost/d1c73f91dd9d175998ed166eb216994a/raw/e89c35f308cee7e2e5a784e1d3afc5d449e9e4bb/counties.geojson')
                    .then(response => response.json())
                    .then(geojson => {
                        // Create a color scale based on the Affordability ranges
                        var colorScale = chroma.scale([
                            '#808080', // Grey
                            '#FF0000', // Red
                            '#FF4500', // Red-Orange
                            '#FFA500', // Orange
                            '#FFFF00', // Yellow
                            '#ADFF2F', // Yellow Green leaning Yellow
                            '#9ACD32', // Yellow Green
                            '#7FFF00', // Green Yellow leaning Green
                            '#008000'  // Green
                        ]).domain([0, 0.3, 0.5, 0.7, 0.9, 1.1, 1.3, 1.5, 1.7, 2.1]);
    
                        // Create a lookup object for Affordability values
                        var affordabilityLookup = {};
                        results.data.forEach(function(row) {
                            affordabilityLookup[row.County] = parseFloat(row.Affordability);
                        });
        
                        // Add the GeoJSON layer to the map
                        L.geoJSON(geojson, {
                            style: function(feature) {
                                var countyFips = feature.properties.GEOID;
                                var affordability = affordabilityLookup[countyFips];
                                return {
                                    fillColor: affordability ? colorScale(affordability).hex() : '#ccc',
                                    fillOpacity: 0.7,
                                    weight: 1,
                                    color: 'white',
                                    dashArray: '3'
                                };
                            }
                        })
                        .addTo(map);

                         // Load the CSV file using fetch API
                        fetch('data.csv', { mode: 'same-origin' })
                            .then(response => response.text())
                            .then(csv => {
                                var results = Papa.parse(csv, { header: true });
                                // Load the GeoJSON file
                                fetch('https://gist.githubusercontent.com/sdwfrost/d1c73f91dd9d175998ed166eb216994a/raw/e89c35f308cee7e2e5a784e1d3afc5d449e9e4bb/counties.geojson')
                                    .then(response => response.json())
                                    .then(geojson => {
                                        // Existing code that creates the color scale and affordability lookup
                
                                        // Create a custom control for the info container
                                        var info = L.control({ position: 'topright' });
                
                                        info.onAdd = function (map) {
                                            var div = L.DomUtil.create('div', 'info-container');
                                            div.innerHTML = '<div class="info-label">Income:COL</div><div class="info-value"></div>';
                                            return div;
                                        };
                
                                        info.addTo(map);
                
                                        // Get the info container element
                                        var infoContainer = document.querySelector('.info-container');
                                        var infoValue = infoContainer.querySelector('.info-value');
                
                                        // Add mouseover and mouseout events to the GeoJSON layer
                                        L.geoJSON(geojson, {
                                            style: function (feature) {
                                                // Existing style function code
                                            },
                                            onEachFeature: function (feature, layer) {
                                                layer.on({
                                                    mouseover: function (e) {
                                                        var countyFips = feature.properties.GEOID;
                                                        var affordability = affordabilityLookup[countyFips];
                
                                                        if (affordability) {
                                                            infoValue.textContent = affordability.toFixed(3);
                                                            infoContainer.style.display = 'block';
                                                        } else {
                                                            infoContainer.style.display = 'none';
                                                        }
                                                    },
                                                    mouseout: function (e) {
                                                        infoContainer.style.display = 'none';
                                                    }
                                                });
                                            }
                                        }).addTo(map);
                                    });
                            });
                    });
            });
    </script>
</body>
</html>
